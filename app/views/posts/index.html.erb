<section class="main-section">
<% if user_signed_in? %>
  <div class="header-lyric">
    <h1>Community Blog</h1>
    <h2><%= current_user.name %></h2>
    <p>Vote on your favorite lyrics or contribute the lyrics from your favorite artists.  <br /><%= link_to "Submit Lyrics", '/campaigns/2/lyrics/new' %></p>

      <div class="results"></div>

  </div>  
<% else %>
  <div class="header-lyric">
     <h1>Community Blog</h1>
    <h2><%= link_to "Join To Contribute", new_user_registration_path %></h2>
    <p>Vote on your favorite lyrics or contribute the lyrics from your favorite artists. <br /><%= link_to "Submit Lyrics", '/campaigns/2' %></p>

    <div class="results"></div>

  </div>  
<% end %>

    <div class="tagcloud">
         <% tag_cloud(@tags, %w(css1 css2 css3 css4)) do |tag, css_class| %>
            <%= link_to tag.name, tagged_url(:tag => tag.name), :class => css_class %>
        <% end %>
    </div>

<section class="post-section">

     <%= link_to 'Most Liked', :controller => 'posts', :sort_by => 'most_liked' %>

     <%= link_to 'Most Viewed', :controller => 'posts', :sort_by => 'most_viewed' %>

   <%= link_to 'Most Recent', :controller => 'posts', :sort_by => 'most_recent' %>

  <div id="posts" class="transitions-enabled">
    <% @posts.each do |post| %>
    <div class="container-post-index">

        
        <%= link_to post.title, post_path(post) %>

        <% unless post.videolink.nil? || post.videolink.empty? %>
			<% if post.typeof == 'video' %>
				<div class="video-box">
				<p><%= raw(youtube_embed(post.videolink)) %></p>
				</div>
			<% end %>
		<% end %>

		<% unless post.audiolink.nil? || post.audiolink.empty? %>
			<% if post.typeof == 'audio' %>
				<p><%= raw(post.audiolink) %></p>
				<% end %>
		<% end %>

		<% unless post.image.nil? || post.image.blank? %>
			<% if post.typeof == 'picture' %>
				<%= image_tag post.image.url(:medium) %>
				<% end %>
		<% end %>
        <ul>
        <li><%= post.impressionist_count(:filter=>:session_hash) %> <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span></li>
        <li><%= post.get_upvotes.size %> 
          <%= link_to like_post_path(post), method: :get do %>
              <span class="glyphicon glyphicon-heart" aria-hidden="true"></span>
            <% end %>
          </li>
        <li><%= post.commentposts.count %> <span class="glyphicon glyphicon-comment" aria-hidden="true"></span></li>
        <li><a class="popoverExampleTwo" data-placement="auto left" data-trigger="click" return false;><%= image_tag post.user.avatar.url(:mini) %></a><%= link_to post.user.username, profile_url(:id => post.user.username) %></li>

                           <!-- Popover 2 hidden content -->
                          <div class="popoverExampleTwoHiddenContent" style="display: none">
                             <div>
                              <%= image_tag post.user.avatar.url(:thumb) %>
                                  <%= link_to post.user.username, profile_url(:id => post.user.username) %>
                                  
                                  </br>
                                  <div class="following-show">
                                    <p><%= post.user.follow_count %> Following  | 
                                    <%= post.user.followers_count %> Followers</p>
                                    <% if user_signed_in? %>
                                      <% if current_user == post.user %>
                                        <p></p>
                                      <% elsif  post.user.all_following.include?(current_user) %>
                                        <%= link_to "Unfollow", unfollow_profile_path(post.user.username) %>
                                      <% else %>
                                        <%= link_to "Follow", follow_profile_path(post.user.username) %>
                                      <% end %>
                                    <% else %>
                                      <p><%= link_to "Sign Up To Follow", new_user_registration_path %></p>
                                    <% end %>
                                  </div>
                                  <hr>
                                  <div class="points-show">
                                    Points | <%= post.user.points %>
                                  </div>


                             </div>
                          </div>  
                          <!-- Popover 2 hidden title -->
                          <div class="popoverExampleTwoHiddenTitle" style="display: none">
                             
                          </div> 

        </ul>
        <br />
        <ul class="tag-list">
        <li><% post.tags.any? %>
          <% post.tags.each do |tag| %>
          <%= link_to tag.name, tagged_url(:tag => tag.name) %>
          <% end %></li>
        </ul>
     
      
      </div>
    <% end %>

    <div class="back-top" title="Top of Page"> <a href="#top" onclick="return false;"><i class="glyphicon glyphicon-chevron-up"></i> Back to Top</a></div> 
  </div>

  

 <br>

   

        
    <br>
    <div class="lyric-footer">
      <%= link_to 'New Post', new_post_path %>
    </div>
</section>
</section>


<%= image_tag 'lyric-background3.png', :class => "background-lyric" %>



	<%= link_to "Add new post", new_post_path %>


<script>
$(function(){


    // Enabling Popover Example 2 - JS (hidden content and title capturing)
    $(".popoverExampleTwo").popover({
        html : true, 
        content: function() {
          return $('.popoverExampleTwoHiddenContent').html();
        },
        title: function() {
          return $('.popoverExampleTwoHiddenTitle').html();
        }
    });
});

</script>

<script>
// fade in #back-top
$(function () {
    $(window).scroll(function () {
        if ($(this).scrollTop() > 300) {
            $('.back-top').fadeIn();
        } else {
            $('.back-top').fadeOut();
        }
    });

    // scroll body to 0px on click
    $('.back-top').click(function () {
        $('body,html').animate({
            scrollTop: 0
        }, 1600);
        return false;
    });
});
</script>
